<form class="form-horizontal m-top-sm" method="post" id="form">
	<div class="form-group">
		<label class="control-label col-md-3">职位</label>
		<div class="col-md-5">
			<select class="form-control" name="info[position]" required onchange="changePositions(this)">
				<option value="">-请选择-</option>
				<foreach name="positionList" item="v">
					<option value="{$v['id']}">{$v['name']}</option>
				</foreach>
			</select>
		</div>
	</div>
	<div class="form-group" id="manager" style="display: none">
		<label class="control-label col-md-3">管理人员</label>
		<div class="col-md-5">
			<select class="form-control" name="info[parent_id]" required>
				<option value="">-请选择-</option>
			</select>
		</div>
	</div>
	<!-- <div class="form-group">
		<label class="control-label col-md-3">账号</label>
		<div class="col-md-5">
			<input type="text" class="form-control input-sm" name="info[username]" id="username" placeholder="必须以字母开头并且6到16位的字母，数字，下划线，减号组合" required>
		</div>
	</div> -->
	<!-- <div class="form-group">
		<label class="control-label col-md-3">登录密码</label>
		<div class="col-md-5">
			<input type="password" class="form-control input-sm" name="password" id="pass" placeholder="6到16位的字母，数字，下划线，减号组合" autocomplete="off" required>
		</div>
	</div> -->
	<div class="form-group">
		<label class="control-label col-md-3">姓名</label>
		<div class="col-md-5">
			<input type="text" class="form-control input-sm" name="info[realname]" value="" required>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label col-md-3">手机号</label>
		<div class="col-md-5">
			<input type="text" class="form-control input-sm" name="info[mobile]" id="mobile" placeholder="" required>
		</div>
	</div>
	<div class="form-group">
		<label class="control-label col-md-3">员工号</label>
		<div class="col-md-5">
			<input type="text" class="form-control input-sm" name="info[job_number]" value="" required>
		</div>
	</div>
	<!-- <div class="form-group">
		<label class="control-label col-md-3">照片</label>
		<div class="col-md-5">
			<button type="button" class="btn btn-success btn-sm" id="selector">选取照片</button>
			<button type="button" class="btn btn-warning btn-sm hide" id="upload">上传</button>
			<span id="filepath"></span>
			<input type="hidden" name="info[avatar]" />
			<p class="m-top-sm"><img src="{:C('ADMIN_IMAGE_PATH')}/noimg.png" width="20%" id="avatar"/></p>
		</div>
	</div> -->
	<div class="form-group">
		<label class="control-label col-md-3">性别</label>
		<div class="col-md-5">
			<div class="radio inline-block">
				<div class="custom-radio m-right-xs">
					<input type="radio" id="sex1" name="info[sex]" value="1" checked="">
					<label for="sex1"></label>
				</div>
				<div class="inline-block vertical-top">男</div>
				<div class="custom-radio m-right-xs">
					<input type="radio" id="sex2" name="info[sex]" value="2" >
					<label for="sex2"></label>
				</div>
				<div class="inline-block vertical-top">女</div>
			</div>
		</div>
	</div>
	<!-- <div class="form-group">
		<label class="control-label col-md-3">E-mail</label>
		<div class="col-md-5">
			<input type="email" class="form-control input-sm" name="info[email]">
		</div>
	</div> -->
	<!--<div class="form-group">-->
		<!--<label class="control-label col-md-3">状态</label>-->
		<!--<div class="col-md-5">-->
			<!--<div class="radio inline-block">-->
				<!--<div class="custom-radio m-right-xs">-->
					<!--<input type="radio" id="islock1" name="info[is_lock]" value="0" checked="">-->
					<!--<label for="islock1"></label>-->
				<!--</div>-->
				<!--<div class="inline-block vertical-top">正常</div>-->
				<!--<div class="custom-radio m-right-xs">-->
					<!--<input type="radio" id="islock2" name="info[is_lock]" value="1" >-->
					<!--<label for="islock2"></label>-->
				<!--</div>-->
				<!--<div class="inline-block vertical-top">冻结</div>-->
			<!--</div>-->
		<!--</div>-->
	<!--</div>-->
	<div class="text-center m-top-md">
		<button type="submit" class="btn btn-info">提交</button>
	</div>
</form>

<script src="{:C('ADMIN_JS_PATH')}/jquery.validate.min.js" type="text/javascript"></script>
<script src="{:C('ADMIN_JS_PATH')}/ajaxupload.js" type="text/javascript"></script>
<script type="text/javascript">
	$(function(){
        $("#form").validate({
	        submitHandler:function(form){
	            confirm();
	        }
	    });
   //      // 创建一个上传参数
   //      var uploadOption = {
   //          // 提交目标
   //          action: "/util.php/Attachment/Index/adminUploadOne",
			// // 服务端接收的名称
			// name: "file",
   //          // 自动提交
   //          autoSubmit: true,
   //          // 选择文件之后…
   //          onChange: function (file, extension) {
   //              if (new RegExp(/(jpg)|(jpeg)|(gif)|(png)/i).test(extension)) {
   //              	$("#upload").removeClass("hide");
   //                  $("#filepath").text(file);
   //              } else {
   //                  DMS.alert("只限上传图片文件，请重新选择！");
   //              }
   //          },
   //          // 开始上传文件
   //          onSubmit: function (file, extension) {
   //              $("#upload").text("正在上传");
   //          },
   //          // 上传完成之后
   //          onComplete: function (file, response) {
   //          	var response = JSON.parse(jQuery(response).text());
   //          	if(response.status == 'success'){
   //          		$("#upload").text("上传完成");
   //          		$("[name='info[avatar]']").val(response.path);
   //          		$("#avatar").attr("src",response.path);
   //          	}
   //          }
   //      }

   //      // 初始化图片上传框
   //      var oAjaxUpload = new AjaxUpload('#selector', uploadOption);
   //      // 给上传按钮增加上传动作
   //      $("#upload").click(function (){
   //          oAjaxUpload.submit();
   //      });
    })
	var submitStatus = true;
	function confirm() {
		if(!submitStatus){
			return
		}
		// var usernamePreg = /^[a-zA-Z][a-zA-Z0-9_-]{5,16}$/;
		// if(!usernamePreg.test($('#username').val())){
		// 	layer.msg("用户名只允许以字母开头并且6到16位的字母，数字，下划线，减号组合",{icon: 0,time: 2000});
		// 	return;
		// }

		// var passPreg = /^[a-zA-Z0-9_-]{6,16}$/;
		// if(!passPreg.test($('#pass').val())){
		// 	layer.msg("密码只允许6到16位的字母，数字，下划线，减号组合",{icon: 0,time: 2000});
		// 	return;
		// }

	    var pattern = /^1[34578]\d{9}$/;
	    var mobile = $("#mobile").val();
        if(!pattern.test(mobile)){
            layer.msg("请输入正确的手机号码",{icon: 0,time: 2000});
            return;
        }
	    submitStatus = false;
		DMS.ajaxPost("__CONTROLLER__/memberAdd",$('#form').serialize(),function(ret){
			submitStatus = true;
			if(ret.status==1){
            	DMS.success("提交成功",0,function(){
					if(ret.url){
            			window.location.href = ret.url;
            		}else{
            			window.location.href = window.location.href;
            		}
				});
            }else{
            	DMS.error(''+ret.info+'',0);
            }
		})
    }
	function changePositions(obj){
		var option = obj.value;
		var item = document.getElementById("manager");
		if(option>0){
			var url = '__CONTROLLER__/getMemberManagers';
			$.post(url,{'parent_id':option},function(data){
				if(data){
					item.style.display = "block";
					item.querySelector("select").innerHTML = "";
					data = '<option value="">-请选择-</option>'+ data;
					item.querySelector("select").innerHTML = data;
				}else{
					item.style.display = "none";
				}
			});
		}else{
			item.style.display = "none";
		}
	}
</script>