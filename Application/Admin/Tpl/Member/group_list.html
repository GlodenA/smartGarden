<style media="screen">
	.text-indent{
		text-indent: 1em;
	}
</style>
<div class="padding-md" id="GROUPLIST">
	<div class="smart-widget widget-dark-blue">
		<div class="smart-widget-inner">
			<div class="smart-widget-body">
				<el-breadcrumb separator="/">
          <el-breadcrumb-item>
            <a href="">首页</a>
          </el-breadcrumb-item>
          <el-breadcrumb-item>
            员工管理
          </el-breadcrumb-item>
          <el-breadcrumb-item>
            员工职位
          </el-breadcrumb-item>
        </el-breadcrumb>
        <el-divider></el-divider>
				<div class="">
					<el-button icon="el-icon-plus" type="primary" @click="addDialog = true">
						添加职位
					</el-button>
				</div>
				<el-table :data="tableData">
					<el-table-column prop="id" label="ID"></el-table-column>
					<el-table-column prop="name" label="名称">
						<template #default="{ row }">
							<div :class="[{ 'text-indent': row.isChild }]">
								{{ `${row.isChild ? '|- ' : ''}${row.name}` }}
							</div>
						</template>
					</el-table-column>
					<el-table-column label="操作">
						<template #default="{ row }">
							<el-button type="primary" size="mini" v-if="!row.isChild" @click="addChild(row)">
								添加下级
							</el-button>
							<el-button type="primary" size="mini" @click="() => {
								editFormData.name = row.name
								editDialog = true
							}">
								编辑
							</el-button>
							<el-button type="danger" size="mini" @click="askDel(row)">
								删除
							</el-button>
						</template>
					</el-table-column>
				</el-table>
			</div>
		</div>
	</div>

	<!-- 添加职位 -->
	<el-dialog title="添加职位" label-width="100px" :visible.sync="addDialog" width="480px">
		<el-form :model="addFormData" :rules="nameRules">
			<el-form-item prop="name" label="名称">
				<el-input v-model="addFormData.name"/>
			</el-form-item>
		</el-form>
		<div slot="footer" class="flex justify-center">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>

	<!-- 添加下级 -->
	<el-dialog title="添加下级" label-width="100px" :visible.sync="addChildDialog" width="480px">
		<el-form :model="addChildFormData" :rules="nameRules">
			<el-form-item prop="name" label="名称">
				<el-input v-model="addChildFormData.name"/>
			</el-form-item>
		</el-form>
		<div slot="footer" class="flex justify-center">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>

	<!-- 编辑职位信息 -->
	<el-dialog title="编辑职位信息" label-width="100px" :visible.sync="editDialog" width="480px">
		<el-form :model="editFormData" :rules="nameRules">
			<el-form-item prop="name" label="名称">
				<el-input v-model="editFormData.name"/>
			</el-form-item>
		</el-form>
		<div slot="footer" class="flex justify-center">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>
</div>
<script>
	let tableData = []
</script>
<foreach name="menuList" item="v">
	<script type="text/javascript">
		tableData.push({
			id: "{$v['id']}",
			name: "{$v['name']}",
		})
	</script>
	<foreach name="v['children']" item="r">
		<script type="text/javascript">
			tableData.push({
				id: "{$r['id']}",
				name: "{$r['name']}",
				isChild: true
			})
		</script>
	</foreach>
</foreach>
<script type="text/javascript">
	const GROUPLIST = new Vue({
		el: '#GROUPLIST',
		data(){
			return {
				nameRules: {
					name: [
						{ required: true, message: '请输入名称！', trigger: 'blur' }
					]
				},
				tableData,
				addChildDialog: false,
				addChildFormData: {
					name: ''
				},
				editDialog: false,
				editFormData: {
					name: ''
				},
				addDialog: false,
				addFormData: {
					name: ''
				}
			}
		},
		mounted(){
		},
		methods: {
			addChild(row){
				this.addChildDialog = true
			},
			askDel(row){
				this.$confirm('确认删除吗?', '提示', {
				 confirmButtonText: '确定',
				 cancelButtonText: '取消',
				 type: 'warning'
			 }).then(() => {
				 this.$message({
					 type: 'success',
					 showClose: true,
					 message: '删除成功!'
				 })
			 }).catch(() => {})
			}
		}
	})
</script>
