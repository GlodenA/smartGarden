<style>
	input[type=file]{
		display: none;
	}
	.avatar-previewer{
		width: 32px;
		height: 32px;
		display: block;
	}
</style>
<div class="padding-md" id="ADMINLIST">
	<div class="smart-widget widget-dark-blue">
		<div class="smart-widget-inner">
			<div class="smart-widget-body">
				<el-breadcrumb separator="/">
          <el-breadcrumb-item>
            <a href="">首页</a>
          </el-breadcrumb-item>
          <el-breadcrumb-item>
            管理员管理
          </el-breadcrumb-item>
          <el-breadcrumb-item>
            管理组列表
          </el-breadcrumb-item>
        </el-breadcrumb>
				<el-divider></el-divider>
				<div class="">
					<el-button icon="el-icon-plus" type="primary" @click="add.dialog = true">
						添加管理组
					</el-button>
				</div>
				<el-table :data="tableData">
					<el-table-column prop="id" label="ID"></el-table-column>
					<el-table-column prop="name" label="名称"></el-table-column>
					<el-table-column prop="description" label="描述"></el-table-column>
					<el-table-column prop="status" label="状态">
						<template #default="{ row }">
							<el-tag type="primary" v-if="row.status === 1">
								正常
							</el-tag>
							<el-tag type="danger" v-else>
								禁止
							</el-tag>
						</template>
					</el-table-column>
					<el-table-column label="操作" width="260">
						<template #default="{ row, column }">
							<el-button size="mini" type="primary" @click="showEditDialog(row)">
								编辑
							</el-button>
							<el-button size="mini" type="primary" @click="showMenuChangeDialog(row)">
								菜单设置
							</el-button>
							<el-button size="mini" type="danger" @click="askDel(row)">
								删除
							</el-button>
						</template>
					</el-table-column>
				</el-table>
				<div class="flex justify-end mt3">
					<el-pagination
						background
						layout="prev, pager, next"
						:total="totalNumber"
						:page-size="10"
						:current-page="page"
						@current-change="pageChange"
					>
					</el-pagination>
				</div>
			</div>
		</div>
	</div>
	<el-dialog title="添加管理组" :visible.sync="add.dialog" width="480px">
		<el-form :model="add.formData" label-width="100px" :rules="adminFormRules">
			<el-form-item label="名称" prop="name">
				<el-input v-model="add.formData.name"></el-input>
			</el-form-item>
			<el-form-item label="登录密码" prop="description">
				<el-input v-model="add.formData.description"></el-input>
			</el-form-item>
			<el-form-item label="状态" prop="status">
				<el-radio v-model="add.formData.status" :label="1">正常</el-radio>
				<el-radio v-model="add.formData.status" :label="0">禁止</el-radio>
			</el-form-item>
		</el-form>
		<div class="flex justify-center" slot="footer">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>

	<el-dialog title="编辑管理员信息" :visible.sync="edit.dialog" width="480px">
		<el-form :model="edit.formData" label-width="100px" :rules="adminFormRules">
			<el-form-item label="名称" prop="name">
				<el-input v-model="edit.formData.name"></el-input>
			</el-form-item>
			<el-form-item label="登录密码" prop="description">
				<el-input v-model="edit.formData.description"></el-input>
			</el-form-item>
			<el-form-item label="状态" prop="status">
				<el-radio v-model="edit.formData.status" :label="1">正常</el-radio>
				<el-radio v-model="edit.formData.status" :label="0">禁止</el-radio>
			</el-form-item>
		</el-form>
		<div class="flex justify-center" slot="footer">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>

	<el-dialog :visible.sync="menuSetting.dialog" title="菜单设置" width="720px">
		<el-tree
		  :data="treeMenuData"
		  show-checkbox
		  node-key="id"
		  :default-checked-keys="menuSetting.targetMenuData"
		 	:default-expanded-keys="menuSetting.targetMenuData"
		  :props="{
				children: 'children',
				label: 'label'
			}">
		</el-tree>
		<div class="flex justify-center" slot="footer">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>
</div>
<script type="text/javascript">
	const ADMINLIST = new Vue({
		el: '#ADMINLIST',
		data(){
			const requiredRule = (n, prefix = '请输入', trigger = 'blur') => ({
				required: true,
				message: `${prefix}${n}！`,
				trigger,
			})
			const commonForm = () => JSON.parse(JSON.stringify({
				name: '',
				description: '',
				status: 1
			}))
			return {
				treeMenuData: Array(3).fill(1).map((_, i) => ({
					id: i + 1,
					label: `一级菜单${i + 1}`,
					children: Array(3).fill(1).map((_, j) => ({
						id: (i + 1) * 3 + j,
						label: `一级菜单${i + 1}的子二级菜单${j + 1}`
					}))
				})),
				totalNumber: 1000,
				page: 1,
				tableData: [{
					id: 1,
					name: '组1',
					description: '普通管理员',
					status: 1,
					menuData: [4, 7, 10]
				}, {
					id: 2,
					name: '组2',
					description: '超级管理员',
					status: 0,
					menuData: [2, 4, 6]
				}],
				adminFormRules: {
					name: [
						requiredRule('名称')
					],
					description: [
						requiredRule('描述')
					]
				},
				add: {
					dialog: false,
					avatarPreview: '',
					formData: commonForm()
				},
				edit: {
					dialog: false,
					avatarPreview: '',
					formData: commonForm()
				},
				menuSetting: {
					dialog: false,
					targetMenuData: []
				}
			}
		},
		created(){

		},
		methods: {
			showEditDialog(row){
				let fd = this.edit.formData
				Object.keys(fd).forEach(f => {
					if(f in row){
						fd[f] = row[f]
					}
				})
				this.edit.avatarPreview = this.edit.formData.avatar
				this.edit.dialog = true
			},
			pageChange(p){
				this.page = p
			},
			askDel(row){
				LOADINGOVERLAY.showConfirm({
					callback: () => {
						// 这里执行确认删除逻辑
						console.log('即将删除的项：', row);
					}
				})
			},
			showMenuChangeDialog(row){
				this.menuSetting.targetMenuData = row.menuData
				this.menuSetting.dialog = true
			}
		}
	})
</script>
