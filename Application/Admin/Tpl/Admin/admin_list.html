<style>
	input[type=file]{
		display: none;
	}
	.avatar-previewer{
		width: 32px;
		height: 32px;
		display: block;
	}
</style>
<div class="padding-md" id="ADMINLIST">
	<div class="smart-widget widget-dark-blue">
		<div class="smart-widget-inner">
			<div class="smart-widget-body">
				<el-breadcrumb separator="/">
          <el-breadcrumb-item>
            <a href="">首页</a>
          </el-breadcrumb-item>
          <el-breadcrumb-item>
            管理员管理
          </el-breadcrumb-item>
          <el-breadcrumb-item>
            管理员列表
          </el-breadcrumb-item>
        </el-breadcrumb>
				<el-divider></el-divider>
				<div class="">
					<el-button icon="el-icon-plus" type="primary" @click="add.dialog = true">
						添加管理员
					</el-button>
				</div>
				<el-table :data="tableData">
					<el-table-column prop="uid" label="UID"></el-table-column>
					<el-table-column prop="account" label="账号"></el-table-column>
					<el-table-column prop="realname" label="姓名"></el-table-column>
					<el-table-column prop="group" label="用户组"></el-table-column>
					<el-table-column prop="registerTime" label="注册时间"></el-table-column>
					<el-table-column prop="lastLogin" label="最后登录"></el-table-column>
					<el-table-column prop="status" label="状态">
						<template #default="{ row }">
							<el-tag type="primary" v-if="row.status === 1">
								正常
							</el-tag>
							<el-tag type="danger" v-else>
								异常
							</el-tag>
						</template>
					</el-table-column>
					<el-table-column label="操作" width="260">
						<template #default="{ row, column }">
							<el-button size="mini" @click="showDetailDialog(row)">
								详情
							</el-button>
							<el-button size="mini" type="primary" @click="showEditDialog(row)">
								编辑
							</el-button>
							<el-button size="mini" type="danger" @click="askDel(row)">
								删除
							</el-button>
						</template>
					</el-table-column>
				</el-table>
				<div class="flex justify-end mt3">
					<el-pagination
						background
						layout="prev, pager, next"
						:total="totalNumber"
						:page-size="10"
						:current-page="page"
						@current-change="pageChange"
					>
					</el-pagination>
				</div>
			</div>
		</div>
	</div>
	<el-dialog title="添加管理员" :visible.sync="add.dialog" width="480px">
		<el-form :model="add.formData" label-width="100px" :rules="adminFormRules">
			<el-form-item label="登录账号" prop="account">
				<el-input v-model="add.formData.account"></el-input>
			</el-form-item>
			<el-form-item label="登录密码" prop="password">
				<el-input v-model="add.formData.password"></el-input>
			</el-form-item>
			<el-form-item label="真实姓名" prop="realname">
				<el-input v-model="add.formData.realname"></el-input>
			</el-form-item>
			<el-form-item label="手机号" prop="mobile">
				<el-input v-model="add.formData.mobile"></el-input>
			</el-form-item>
			<el-form-item label="头像" prop="avatar">
				<el-upload action="" :before-upload="beforeAvatarUpload" :before-remove="() => {
					add.formData.avatar = ''
					add.avatarPreview = ''
				}">
					<img v-if="add.avatarPreview" :src="add.avatarPreview" class="avatar-previewer">
					<el-button v-else icon="el-icon-plus" round type="primary"></el-button>
				</el-upload>
			</el-form-item>
			<el-form-item label="管理组" prop="group">
				<el-select v-model="add.formData.group">
					<el-option v-for="({ id, name }) in groupOptions" :key="id" :label="name" :value="id">
					</el-option>
				</el-select>
			</el-form-item>
		</el-form>
		<div class="flex justify-center" slot="footer">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>

	<el-dialog :visible.sync="detail.dialog" title="管理员详情" width="480px">
		<el-table :data="detail.tableData" :show-header="false" border>
			<el-table-column prop="label"></el-table-column>
			<el-table-column prop="value"></el-table-column>
		</el-table>
	</el-dialog>

	<el-dialog title="编辑管理员信息" :visible.sync="edit.dialog" width="480px">
		<el-form :model="edit.formData" label-width="100px" :rules="adminFormRules">
			<el-form-item label="登录账号" prop="account">
				<el-input v-model="edit.formData.account"></el-input>
			</el-form-item>
			<el-form-item label="登录密码" prop="password">
				<el-input v-model="edit.formData.password"></el-input>
			</el-form-item>
			<el-form-item label="真实姓名" prop="realname">
				<el-input v-model="edit.formData.realname"></el-input>
			</el-form-item>
			<el-form-item label="手机号" prop="mobile">
				<el-input v-model="edit.formData.mobile"></el-input>
			</el-form-item>
			<el-form-item label="头像" prop="avatar">
				<el-upload action="" :before-upload="beforeAvatarUpload" :before-remove="() => {
					edit.formData.avatar = ''
					edit.avatarPreview = ''
				}">
					<img v-if="edit.avatarPreview" :src="edit.avatarPreview" class="avatar-previewer">
					<el-button v-else icon="el-icon-plus" round type="primary"></el-button>
				</el-upload>
			</el-form-item>
			<el-form-item label="管理组" prop="group">
				<el-select v-model="edit.formData.group">
					<el-option v-for="({ id, name }) in groupOptions" :key="id" :label="name" :value="id">
					</el-option>
				</el-select>
			</el-form-item>
		</el-form>
		<div class="flex justify-center" slot="footer">
			<el-button type="primary">
				提交
			</el-button>
		</div>
	</el-dialog>
</div>
<script type="text/javascript">
	const ADMINLIST = new Vue({
		el: '#ADMINLIST',
		data(){
			const requiredRule = (n, prefix = '请输入', trigger = 'blur') => ({
				required: true,
				message: `${prefix}${n}！`,
				trigger,
			})
			return {
				groupOptions: Array(5).fill(-1).map((_, i) => ({
					name: `管理组${i + 1}`,
					id: i + 1
				})),
				totalNumber: 1000,
				page: 1,
				tableData: [{
					uid: 5,
					account: '管理员1',
					realname: '普通管理员',
					group: '普通管理员组',
					registerTime: '2019-11-22 09:00:00',
					lastLogin: '2019-11-22 09:00:00',
					status: 1,
					mobile: '18888888888',
					avatar: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100',
					password: '123456',
				}, {
					uid: 6,
					account: '管理员2',
					realname: '超级管理员',
					group: '超级管理员组',
					registerTime: '2019-11-22 09:00:00',
					lastLogin: '2019-11-22 09:00:00',
					status: 0,
					mobile: '17777777777',
					avatar: 'https://fuss10.elemecdn.com/3/63/4e7f3a15429bfda99bce42a18cdd1jpeg.jpeg?imageMogr2/thumbnail/360x360/format/webp/quality/100',
					password: '123456',
				}],
				adminFormRules: {
					account: [
						requiredRule('账号')
					],
					password: [
						requiredRule('密码')
					],
					realname: [
						requiredRule('姓名')
					],
					mobile: [
						requiredRule('手机号')
					],
					avatar: [
						requiredRule('手机号', '请上传')
					],
					group: [
						requiredRule('用户组', '请选择', 'change')
					]
				},
				add: {
					dialog: false,
					avatarPreview: '',
					formData: {
						account: '',
						password: '',
						realname: '',
						mobile: '',
						avatar: '',
						group: ''
					}
				},
				detail: {
					dialog: false,
					tableData: []
				},
				edit: {
					dialog: false,
					avatarPreview: '',
					formData: {
						account: '',
						password: '',
						realname: '',
						mobile: '',
						avatar: '',
						group: ''
					}
				}
			}
		},
		created(){

		},
		methods: {
			showDetailDialog(row){
				this.detail.tableData = [
					['account', '用户账号'],
					['group', '管理组'],
					['realname', '姓名'],
					['mobile', '手机号']
				].map(([f, label]) => ({
					label,
					value: row[f]
				}))
				this.detail.dialog = true
			},
			showEditDialog(row){
				let fd = this.edit.formData
				Object.keys(fd).forEach(f => {
					if(f in row){
						fd[f] = row[f]
					}
				})
				this.edit.avatarPreview = this.edit.formData.avatar
				this.edit.dialog = true
			},
			beforeAvatarUpload(f){
				this.add.formData.avatar = f
				this.add.avatarPreview = window.URL.createObjectURL(f)
			},
			pageChange(p){
				this.page = p
			},
			askDel(row){
				LOADINGOVERLAY.showConfirm({
					callback: () => {
						// 这里执行确认删除逻辑
						console.log('即将删除的项：', row);
					}
				})
			}
		}
	})
</script>
