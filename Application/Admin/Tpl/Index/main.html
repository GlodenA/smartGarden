<style type="text/css">
	#MAIN {
		color: #000;
	}

	#MAIN .panel-card {
		cursor: pointer;
		border-radius: 20px;
		background-color: #efefef;
	}

	#MAIN .panel-card:hover {
		background-color: #33D792;
		color: white;
	}

	#MAIN .panel-card .card-icon{
		color: #33D792;
		font-size: 32px;
	}

	#MAIN .panel-card:hover .card-icon{
		color: white;
	}

	#MAIN .panel-card p{
		color: #999;
	}

	#MAIN .panel-card:hover p{
		color: inherit;
	}

	#MAIN .real-time-monitor p{
		color: #999;
	}

	#MAIN .real-time-monitor h1{
		font-size: 56px;
	}

	#MAIN .real-time-monitor .add-btn{
		border: 1px dashed #ccc;
		border-radius: 3px;
		cursor: pointer;
	}

	#MAIN .real-time-monitor .add-btn:hover{
		border-color: #33D792;
	}

	#MAIN .real-time-monitor .add-btn i{
		font-size: 32px;
		color: #33D792;
	}

	#MAIN .real-time-selector{
		border: 1px solid #ddd;
		color: #999;
		padding: 12px 0;
		text-align: center;
		cursor: pointer;
		transition: all ease-in-out .2s;
		position: relative;
	}

	#MAIN .real-time-selector:hover:not(.selected),
	#MAIN .real-time-selector.selected{
		border-color: #33D792;
	}

	#MAIN .real-time-selector .checked{
		width: 20px;
		height: 18px;
		position: absolute;
		bottom: 0;
		right: 0;
		background-color: #33D792;
		color: white;
	}
</style>

<div id="MAIN" class="p3 bg-white">
	<div class="p2 bold h2 mt0">
  	常用菜单
  </div>
	<el-row :gutter="20" >
		<el-col :span="6" v-for="([icon, title, subtitle, menu, address], i) in [
			['date', '考勤记录', '今日考勤记录', '__MODULE__/Attendance/attendanceList', '__MODULE__/Attendance/attendanceList/start_time/{$newTime}/end_time/{$newTime}'],
			['s-custom', '员工管理', '员工列表', '__MODULE__/Member/memberList', '__MODULE__/Member/memberList'],
			['map-location', '设备位置', '电子栅栏', '__MODULE__/Map/mapMachine', '__MODULE__/Map/mapAllFence'],
			['mobile-phone', '设备管理', '设备列表', '__MODULE__/Machine/machineList', '__MODULE__/Machine/machineList']
		]" :key="i">
			<el-card class="panel-card" shadow="hover">
				<div class="row items-center justify-center">
					<i :class="[`el-icon-${icon}`, 'card-icon']"></i>
					<div class="ml3">
						<a :href=menu><h4>{{ title }}</h4></a>
						<a :href=address><p>{{ subtitle }}</p></a>
					</div>
				</div>
			</el-card>
		</el-col>
	</el-row>
	<el-divider></el-divider>
	<div class="p2 bold h2">
  	实时监控
  </div>
	<el-row :gutter="20" class="px4 real-time-monitor flex items-stretch py2">
		<el-col :span="6" v-for="(n, i) in realTimeMonitorData" :key="i" :class="['column', 'items-center', realTimeMonitorColor[i]]">
			<p>{{ realTimeMonitorDataLabelArr[i] }}</p>
			<h1 class="m0">
				{{ n }}
			</h1>
		</el-col>
		<el-col :span="6" class="add-btn flex justify-center items-center" @click.native="realTimeDialog = true">
			<i class="el-icon-plus"></i>
		</el-col>
	</el-row>
	<el-divider></el-divider>
	<div class="flex justify-between items-center">
		<div class="p2 bold h2">
			异常警告
		</div>
		<a href="__MODULE__/WarningMessage/warningMessageList">
		<el-button icon="el-icon-right" plain type="primary">
			查看更多
		</el-button>
		</a>
	</div>
	<el-table style="width: 100%" id="tableData"  v-bind:data="tableData">
		<template  v-for="({ prop, label }, i) in tableColumns">
			<el-table-column :key="i" :prop="prop" :label="label" v-if="prop !== 'warningType'"></el-table-column>
			<el-table-column :key="i" v-else :prop="prop" :label="label">
				<template #default="{ row}">
					<el-tag type="danger">
						{{ row.warningType }}
					</el-tag>
				</template>
			</el-table-column>
		</template>
 </el-table>
 <el-dialog
	title="实时监控"
	:visible.sync="realTimeDialog"
	width="50%">
	<el-row :gutter="20">
		<el-col :span="6" v-for="({ label, selected }, i) in realTimeMenusWithSelectedStates" class="mb2">
			<div :class="['real-time-selector', { 'selected': selected}]" @click="() => toggleRealTimeMenuSelectedState(label, selected)">
				{{ label }}
				<div class="checked" v-show="selected">
					<i class="el-icon-check"></i>
				</div>
			</div>
		</el-col>
	</el-row>
  <span slot="footer" class="flex justify-center">
		<el-button type="primary" @click="dialogVisible = false">确 定</el-button>
    <el-button @click="realTimeDialog = false">重置</el-button>
  </span>
</el-dialog>
</div>
<script type="text/javascript">

	const main = new Vue({
		el: '#MAIN',
		data() {
			return {
				selectedRealTimeMenus: [
					'当前在线设备数',
					'迟到',
					'旷工'
				],
				realTimeMenus: [
					'总设备数',
					'今日上线设备总数',
					'当前在线设备数',
					'员工总数',
					'在岗人数',
					'离岗人数',
					'未上岗人数',
					'迟到',
					'上午考勤统计',
					'下午考勤统计',
					'正常上班打卡',
					'正常下班打卡',
					'旷工',
					'早退',
					'异常情况'
				],
				realTimeDialog: false,
				tableData: null,
				tableColumns: [
					['设备名称', 'machine_name'],
					['设备号', 'machine_imei'],
					['绑定员工', 'realname'],
					['工号', 'job_number'],
					['职位', 'position'],
					['管理人员', 'parent_id'],
					['告警时间', 'add_time'],
					['告警类型', 'type'],
				].map(([ label, prop ]) => ({
					label,
					prop
				})),
				realTimeMonitorData: [259, 13, 31],
				realTimeMonitorColor: ['primary', 'warning', 'danger'],
				realTimeMonitorDataLabelArr: ['当前设备在线数', '迟到', '旷工']
			}
		},
		computed: {
			realTimeMenusWithSelectedStates(){
				return this.realTimeMenus.map(label => ({
					label,
					selected: this.selectedRealTimeMenus.some(v => v === label)
				}))
			}
		},
		methods: {
			getData(){
				DMS.ajaxPost('__MODULE__/Index/main' , {
					page: null,
				}, res => {
					var option=[];
					this.tableData=res['list_today'];

					for (var a=0;a<res['options'].length;a++){
						option.push(res['options'][a].showname);
					}
					this.realTimeMenus=option;
					//遍历一次useroption，给各种东西进行赋值
					var userOption=[];
					var userOptionValue=[];
					for (var a=0;a<res['userOptions'].length;a++){
						switch (res['userOptions'][a]) {
							case '1':
								userOption.push('总设备数');
								userOptionValue.push(res['mahcine_count']);
								break;
							case '2':
								userOption.push('今日上线设备总数');
								userOptionValue.push(res['today_mount_guard_count']);
								break;
							case '3':
								userOption.push('当前在线设备数');
								userOptionValue.push(res['mount_guard_count']);
								break;
							case '4':
								userOption.push('员工总数');
								userOptionValue.push(res['count_member']);
								break;
							case '5':
								userOption.push('在岗人数');
								userOptionValue.push(res['on_guard_count']);
								break;
							case '6':
								userOption.push('离岗人数');
								userOptionValue.push(res['out_guard_count']);
								break;
							case '7':
								userOption.push('未上岗人数');
								userOptionValue.push(res['no_guard_count']);
								break;
							case '8':
								userOption.push('上午考勤统计');
								userOptionValue.push(res['morning']);
								break;
							case '9':
								userOption.push('下午考勤统计');
								userOptionValue.push(res['afternoon']);
								break;
						}
					}
					console.log('sdsdsdsdsd'+userOption);

					this.selectedRealTimeMenus=userOption;
					this.realTimeMonitorDataLabelArr=userOption;
					this.realTimeMonitorData=userOptionValue;

				})
			},
			toggleRealTimeMenuSelectedState(label, state){
				if(state){
					this.selectedRealTimeMenus.splice(this.selectedRealTimeMenus.findIndex(v => v === label), 1)
					return
				}
				this.selectedRealTimeMenus.push(label)
			}
		}
	})
	main.getData();
</script>
