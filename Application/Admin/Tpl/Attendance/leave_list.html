<link href="{:C('ADMIN_JS_PATH')}/layui/css/layui.css" rel="stylesheet">
<div class="padding-md">
    <!-- 面包屑导航 -->
    <div>
        <ul class="breadcrumb">
            当前位置：
            <li><a href="#">主页</a></li>
            <li><a href="__MODULE__">请假列表</a></li>
            <li><a href="__CONTROLLER__/leaveApply">请假申请</a></li>
        </ul>
    </div>
    <div class="smart-widget" style="margin-bottom: 1px;">
        <div class="smart-widget-inner">
            <div class="smart-widget-body">
                <div class="header-text">
                    请假列表
                </div>
                <div class="info-line clearfix">
                    <form class="navtop-form form-inline pull-left" id="search-form" action="" method="post">
                        <div class="form-group">
                            <label for="keywords">关键字：</label>
                            <input type="text" class="form-control time-input" id="keywords" name="keywords" value="{$keywords}" placeholder="根据员工号或者姓名查询">
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control time-input" name="start_time" id="start_time" value="{$start_time}" placeholder="起始时间">
                        </div>
                        <div class="form-group">
                            <label for="end_time">～</label>
                            <input type="text" class="form-control time-input" name="end_time" id="end_time" value="{$end_time}" placeholder="结束时间">
                        </div>
                        <a id="search" url="__ACTION__" class="btn btn-sm btn-info">
                            查询
                        </a>
                        <!--<a href="__CONTROLLER__/exportAttendanceList/" id="export" class="btn btn-sm btn-info">-->
                            <!--导出Excel-->
                        <!--</a>-->
                        <a href="__ACTION__" class="btn btn-sm btn-info">
                            刷新
                        </a>
                    </form>
                </div>
                <div class="smart-widget-inner">
                    <table class="table table-striped table-bordered" id="dataTable">
                        <thead>
                        <tr>
                            <th>工号</th>
                            <th>姓名</th>
                            <th>请假开始时间</th>
                            <th>请假结束时间</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <foreach name="list" item="v">
                            <tr id="data-{$v['id']}">
                                <td>{$v['job_number']}</td>
                                <td>{$v['realname']}</td>
                                <td>{$v['leave_start_time']|date="Y-m-d H:i:s",###}</td>
                                <td>{$v['leave_end_time']|date="Y-m-d H:i:s",###}</td>
                                <td>{$v['add_time']|date="Y-m-d H:i:s",###}</td>
                                <td>
                                    <a href="javascript:leaveDelete({$v['id']});" style="color: #f03939;"><i class="fa fa-trash-o m-right-xs"></i>删除</a>
                                </td>
                            </tr>
                        </foreach>
                        </tbody>
                    </table>
                    <div class="content text-right">
                        <ul class="pagination">
                            {$page}
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<script src="{:C('ADMIN_JS_PATH')}/layui/layui.js"></script>
<script src="{:C('ADMIN_JS_PATH')}/time.js"></script>
<script type="text/javascript">
    $(function() {
        //搜索功能
        $("#search").click(function () {
            var url = $(this).attr('url');
            var query = $('#search-form').find('.time-input').serialize();
            if (url.indexOf('?') > 0) {
                url += '&' + query;
            } else {
                url += '?' + query;
            }
            window.location.href = url;
        });
    })
    $(document).ready(function(){
        layui.use('laydate', function(){
            var laydate = layui.laydate;
            var start = laydate.render({
                elem: '#start_time',
                type: 'date',
                theme: 'grid',
                festival: true, //显示节日
                calendar: true,
                max:0,
                done: function(value, date){
                    endMax = end.config.max;
                    end.config.min = date;
                    end.config.min.month = date.month -1;
                    end.config.min.date = date.date;
                }
            });

            var end = laydate.render({
                elem: '#end_time',
                type: 'date',
                theme: 'grid',
                festival: true, //显示节日
                calendar: true,
                max:0,
                done: function(value, date){
                    start.config.max = date;
                    start.config.max.month = date.month -1;
                    start.config.max.date = date.date;
                }
            });
        });
//        var nowTime = new Date().valueOf()/1000;
//        $('#start_time').val(dateTime('Y-m-d',nowTime));
//        $('#end_time').val(dateTime('Y-m-d',nowTime));
    });
    function leaveDelete(id){
        DMS.dialog("确定要删除吗?",function(){
            DMS.ajaxPost("__CONTROLLER__/leaveDelete",{id:id},function(ret,err){
                console.log(JSON.stringify(ret));
                if(ret.status==1){
                    DMS.success(ret.info,0,function(){
                        $("#data-"+id).remove();
                    });
                }else{
                    DMS.error(ret.info,0);
                }
            })
        });

    }
</script>